# 제약 조건 이름 직접 지정
CREATE TABLE TABLE_NOTNULL2 (
    LOGIN_ID    VARCHAR2(20)  CONSTRAINT TBLNN2_LGNID_NN  NOT NULL,
    LOGIN_PWD   VARCHAR2(20)  CONSTRAINT TBLNN2_LGNPW_NN  NOT NULL,
    TEL         VARCHAR2(20)
);


# 이미 지정된 제약조건을 추가하거나 수정
SELECT * FROM TABLE_NOTNULL;

ALTER TABLE TABLE_NOTNULL2 MODIFY (TEL NOT NULL);

# 14-8 TEL컬럼 NULL제거 ==> UPDATE
UPDATE TABLE_NOTNULL SET TEL = '010-1234-5678' WHERE LOGIN_ID = 'TEST_ID_01';

# 제약조건 이름지정 후 수정
ALTER TABLE TABLE_NOTNULL MODIFY (TEL CONSTRAINT TALNN_TEL_NN NOT NULL);

# 14-11 테이블 구조 확인
DESC TABLE_NOTNULL2;

# 14-12 이미 이름이 생성된 제약조건 이름 변경하기
ALTER TABLE TABLE_NOTNULL2
RENAME CONSTRAINT TBLNN_TEL_NN TO TBLNN2_TEL_NN;

# 14-13 제약조건 삭제
ALTER TABLE TABLE_NOTNULL2
DROP CONSTRAINT TBLNN2_TEL_NN;

# TABLE_NOTNULL2 테이블의 TEL 컬럼에 NOT NULL 제약조건 추가하는 코드를 만드시오.
ALTER TABLE TABLE_NOTNULL2 MODIFY (TEL CONSTRAINT MY_01 NOT NULL);

# 14-14
CREATE TABLE TABLE_UNIQUE (
    LOGIN_ID    VARCHAR2(20) UNIQUE,
    LOGIN_PWD   VARCHAR2(20) NOT NULL,
    TEL         VARCHAR2(20)
);
DESC TABLE_UNIQUE;

# 14-16
INSERT INTO TABLE_UNIQUE (LOGIN_ID, LOGIN_PWD, TEL)
VALUES ('TEST_ID_03', 'PWD03', '010-1234-5678');

INSERT INTO TABLE_UNIQUE (LOGIN_ID, LOGIN_PWD, TEL)
VALUES (NULL , 'PWD04', '010-1234-5678');

# 14-4 유일하게 하나만 있는 값 UNIQUE, NOT NULL ==> PRIMARY KEY
DROP TABLE TABLE_PK;
# 14-32
CREATE TABLE TABLE_PK2 (
    LOGIN_ID    VARCHAR2(20) CONSTRAINT TBLPK2_LGNID_PK PRIMARY KEY,
    LOGIN_PWD   VARCHAR2(20) CONSTRAINT TBLPK2_LGNPW_NN NOT NULL,
    TEL         VARCHAR2(20)
);
DESC TABLE_PK2;


INSERT INTO TABLE_PK2 (LOGIN_ID, LOGIN_PWD, TEL)
VALUES (NULL, 'PWD03', '010-1234-5678');


# 14-30 생성한 기본키 확인하기
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS WHERE TABLE_NAME LIKE 'TABLE_PK%';

# 한발 더 나가기
CREATE TABLE TABLE_PK3 (
    LOGIN_ID    VARCHAR2(20),
    LOGIN_PWD   VARCHAR2(20),
    TEL         VARCHAR2(20),
    PRIMARY KEY(LOGIN_ID),
    CONSTRAINT TBLPK3_LGNPW_NN UNIQUE (LOGIN_PWD)
);

# 다른 테이블과 관계 FOREIGN KEY
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS WHERE TABLE_NAME IN ('EMP', 'DEPT');


# 14-38 FK참조하는 컬럼에 존재하지 않는 데이터 입력하기
INSERT INTO EMP(EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM, DEPTNO)
VALUES (9999, '홍길동', 'CLERK', '7788', TO_DATE('2017.04.30', 'YYYY/MM/DD'), 1200, NULL, 30);

DELETE FROM EMP WHERE ENAME = '홍길동';
COMMIT;

# 14-39
# DEPT_FK 테이블 생성
CREATE TABLE DEPT_FK (
    DEPTNO  NUMBER(2)   CONSTRAINT DEPTFK_DEPTNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(14),
    LOC     VARCHAR2(13)
);

# EMP_FK 테이블 생성
CREATE TABLE EMP_FK (
    EMPNO       NUMBER(4)   CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    ENAME       VARCHAR2(10),
    JOB         VARCHAR2(9),
    MGR         NUMBER(4),
    HIREDATE    DATE,
    SAL         NUMBER(7,2),
    COMM        NUMBER(7,2),
    DEPTNO      NUMBER(2)   CONSTRAINT EMPFK_DEPTNO_FK REFERENCES DEPT_FK (DEPTNO) ON DELETE SET NULL
);

SELECT * FROM EMP_FK;
SELECT * FROM DEPT_FK;

# 14-41 안될거알아서 안함

# 14-42 DEPT_FK
INSERT INTO DEPT_FK
VALUES (10, 'TEST_DNAME', 'TEST_LOC');

# 14-43 EMP_FK
INSERT INTO EMP_FK
VALUES (9999, '홍길동', 'CLERK', '7788', TO_DATE('2017.04.30', 'YYYY/MM/DD'), 1200, NULL, 10);

DELETE FROM DEPT_FK
WHERE DEPTNO = 10;

SELECT * FROM EMP_FK;
SELECT * FROM DEPT_FK;

# 14-45 데이터 형태와 범위를 정하는 CHECK
CREATE TABLE TABLE_CHECK (
    LOGIN_ID    VARCHAR2(20)    CONSTRAINT TBLCK_DEPTNO_PK  PRIMARY KEY,
    LOGIN_PWD   VARCHAR2(20)    CONSTRAINT TBLCK_LOGINPW_CK CHECK (LENGTH(LOGIN_PWD) > 3),
    TEL         VARCHAR2(20)    DEFAULT '010-1111-1111'
);

SELECT * FROM TABLE_CHECK;

# 14-46 입력
INSERT INTO TABLE_CHECK (LOGIN_ID, LOGIN_PWD)
VALUES ('TEST_ID', '1234');

# 제약조건 확인
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS WHERE TABLE_NAME LIKE 'TABL   E_CHECK';

# DEPT_CONST 테이블과 EMP_CONST 테이블을 만들어라
CREATE TABLE DEPT_CONST (
    DEPTNO  NUMBER(2)       CONSTRAINT DEPTCONST_DEPTNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(14)    CONSTRAINT DEPTCONST_DNAME_UNQ UNIQUE,
    LOC     VARCHAR2(13)    CONSTRAINT DEPTCONST_LOC_NN NOT NULL
);

CREATE TABLE EMP_CONST (
    EMPNO       NUMBER(4)       CONSTRAINT EMPCONST_EMPNO_PK PRIMARY KEY,
    ENAME       VARCHAR2(10)    CONSTRAINT EMPCONST_ENAME_NN NOT NULL,
    JOB         VARCHAR2(9),
    TEL         NUMBER(20)      CONSTRAINT EMPCONST_TEL_UNQ UNIQUE,
    HIREDATE    DATE,
    SAL         NUMBER(7,2)     CONSTRAINT EMPCONST_SAL_CHK CHECK (SAL BETWEEN 1000 AND 9999),
    COMM        NUMBER(7,2),
    DEPTNO      NUMBER(2)       CONSTRAINT EMPCONST_DEPTNO_FK REFERENCES DEPT_CONST (DEPTNO)
);

INSERT INTO EMP_CONST (EMPNO, ENAME, JOB, TEL, HIREDATE, SAL, COMM, DEPTNO)
VALUES (9999, '홍길동', 'CLERK', '7781616', TO_DATE('2017.04.30', 'YYYY/MM/DD'), 1200, 300, 10);

INSERT INTO DEPT_CONST
VALUES (10, 'TEST_DNAME', 'TEST_LOC');
